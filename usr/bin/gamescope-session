#!/bin/bash

# Assume that MangoHud is not installed
MANGOAPP_FLAG=""

# Check that mangoapp is available. Set the flag if it exists,
# otherwise inform to check that MangoHud is installed and
# proceed without the flag.
if command -v mangoapp &> /dev/null;
then
    MANGOAPP_FLAG="--mangoapp"
else
    printf "[%s] [Info] 'mangoapp' is not available on your system. Check to see that MangoHud is installed.\n" $0
    printf "[%s] [Info] Continuing without the '--mangoapp' flag.\n" $0
fi

PREFER_DEVICE=""

for card in /sys/class/drm/card[0-9]*; do
  for output in "$card"-*; do
    if [ -e "$output/status" ] && [ $(cat "$output/status") = "connected" ]; then
        read vendor <"${card}/device/vendor"
        read device <"${card}/device/device"
        PREFER_DEVICE="--prefer-vk-device "${vendor#0x}:${device#0x}""
        break 2
    fi
  done
done


gamescope \
    ${MANGOAPP_FLAG} ${PREFER_DEVICE} \
    -e -- steam -steamdeck -steamos3
